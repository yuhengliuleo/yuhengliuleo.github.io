<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>了解区块链（2）:比特币的基本架构 | Leo</title>
<meta name="keywords" content="">
<meta name="description" content="上篇文章在结尾总结到：
1.
货币需要具有标准化、稀缺性、防伪性，可分割性与耐久性等特征，需要有价值储存功能；
2. 货币的价值来源于市场中交易者的“共识”而不是货币本身的物理属性。
本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。
标准化、可分割性、稀缺性、防伪性、耐久性以及价值存储等特征是一个物品能够成为货币的基础。
比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。
在比特币系统中，有交易需求的双方不需要借助任何可信任的第三方（中间方）即可完成点对点的直接交易。
一、比特币系统的基础设施
1.来自于密码学的非对称加密算法
密码学贯穿于比特币的发行、流通等各环节。
本文以哈希函数算法为例，其主要特征为：


单向性。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；


抗碰撞。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；


雪崩效应。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这60万字中修改一个标点符号，经过哈希函数算法处理后生成的哈希值都会完全不同；


隐藏性。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。


比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终固定为
256 位的二进制数据​​，通常以 ​​64
个字符的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）
除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。
2.分布式网络
比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于全球各地的无数台彼此无关的计算机中（也称之为节点）。
分布式网络能够带来稳定性与自由性。在比特币系统中，即使部分节点失效，系统整体仍可继续运作，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。
出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：全节点和轻节点。
全节点保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；
轻节点并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。
从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右。
3.私钥、公钥和地址
在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。地址是实现比特币流转的基础。
私钥，是比特币系统中对所拥有的比特币所有权本身，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。
公钥，是一个数学上与私钥配对的公开的信息，是验证数字签名的重要工具。
地址，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。
公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。
私钥、公钥以及地址的具体生成机制如下：
第一步，系统随机生成私钥
私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1
~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2
5E8C D036 4141（即椭圆曲线上的点的总数）之间。
我们使用软件随机生成一个私钥：
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
第二步，使用椭圆曲线算法得出公钥
椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。
在生成私钥
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：
公钥P.X：
06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385
公钥P.Y：
FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
将上述公钥地址拼合，得到标准地址：
0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
第三步，计算公钥的SHA-256哈希值
在得到公钥的标准地址：
“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”
后，将该标准地址对齐进行SHA-256哈希计算，得到结果：
“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“">
<meta name="author" content="">
<link rel="canonical" href="https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/understanding-blockchain-02/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.dd26ee10db300a86a04f8a221d7fb986f8fd4b339a215a6d7698fefec0f65d30.css" integrity="sha256-3SbuENswCoagT4oiHX&#43;5hvj9SzOaIVptdpj&#43;/sD2XTA=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://yuhengliuleo.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://yuhengliuleo.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://yuhengliuleo.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://yuhengliuleo.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://yuhengliuleo.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/understanding-blockchain-02/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/understanding-blockchain-02/">
  <meta property="og:site_name" content="Leo">
  <meta property="og:title" content="了解区块链（2）:比特币的基本架构">
  <meta property="og:description" content="上篇文章在结尾总结到：
1. 货币需要具有标准化、稀缺性、防伪性，可分割性与耐久性等特征，需要有价值储存功能；
2. 货币的价值来源于市场中交易者的“共识”而不是货币本身的物理属性。
本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。
标准化、可分割性、稀缺性、防伪性、耐久性以及价值存储等特征是一个物品能够成为货币的基础。
比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。
在比特币系统中，有交易需求的双方不需要借助任何可信任的第三方（中间方）即可完成点对点的直接交易。
一、比特币系统的基础设施 1.来自于密码学的非对称加密算法 密码学贯穿于比特币的发行、流通等各环节。
本文以哈希函数算法为例，其主要特征为：
单向性。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；
抗碰撞。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；
雪崩效应。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这60万字中修改一个标点符号，经过哈希函数算法处理后生成的哈希值都会完全不同；
隐藏性。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。
比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终固定为 256 位的二进制数据​​，通常以 ​​64 个字符的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）
除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。
2.分布式网络 比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于全球各地的无数台彼此无关的计算机中（也称之为节点）。
分布式网络能够带来稳定性与自由性。在比特币系统中，即使部分节点失效，系统整体仍可继续运作，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。
出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：全节点和轻节点。
全节点保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；
轻节点并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。
从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右。
3.私钥、公钥和地址 在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。地址是实现比特币流转的基础。
私钥，是比特币系统中对所拥有的比特币所有权本身，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。
公钥，是一个数学上与私钥配对的公开的信息，是验证数字签名的重要工具。
地址，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。
公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。
私钥、公钥以及地址的具体生成机制如下：
第一步，系统随机生成私钥
私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1 ~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4141（即椭圆曲线上的点的总数）之间。
我们使用软件随机生成一个私钥：
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
第二步，使用椭圆曲线算法得出公钥
椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。
在生成私钥
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：
公钥P.X：
06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385
公钥P.Y：
FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
将上述公钥地址拼合，得到标准地址：
0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
第三步，计算公钥的SHA-256哈希值
在得到公钥的标准地址：
“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”
后，将该标准地址对齐进行SHA-256哈希计算，得到结果：
“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="分类">
    <meta property="article:published_time" content="2025-09-09T10:00:00+08:00">
    <meta property="article:modified_time" content="2025-09-09T10:00:00+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="了解区块链（2）:比特币的基本架构">
<meta name="twitter:description" content="上篇文章在结尾总结到：
1.
货币需要具有标准化、稀缺性、防伪性，可分割性与耐久性等特征，需要有价值储存功能；
2. 货币的价值来源于市场中交易者的“共识”而不是货币本身的物理属性。
本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。
标准化、可分割性、稀缺性、防伪性、耐久性以及价值存储等特征是一个物品能够成为货币的基础。
比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。
在比特币系统中，有交易需求的双方不需要借助任何可信任的第三方（中间方）即可完成点对点的直接交易。
一、比特币系统的基础设施
1.来自于密码学的非对称加密算法
密码学贯穿于比特币的发行、流通等各环节。
本文以哈希函数算法为例，其主要特征为：


单向性。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；


抗碰撞。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；


雪崩效应。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这60万字中修改一个标点符号，经过哈希函数算法处理后生成的哈希值都会完全不同；


隐藏性。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。


比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终固定为
256 位的二进制数据​​，通常以 ​​64
个字符的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）
除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。
2.分布式网络
比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于全球各地的无数台彼此无关的计算机中（也称之为节点）。
分布式网络能够带来稳定性与自由性。在比特币系统中，即使部分节点失效，系统整体仍可继续运作，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。
出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：全节点和轻节点。
全节点保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；
轻节点并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。
从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右。
3.私钥、公钥和地址
在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。地址是实现比特币流转的基础。
私钥，是比特币系统中对所拥有的比特币所有权本身，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。
公钥，是一个数学上与私钥配对的公开的信息，是验证数字签名的重要工具。
地址，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。
公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。
私钥、公钥以及地址的具体生成机制如下：
第一步，系统随机生成私钥
私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1
~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2
5E8C D036 4141（即椭圆曲线上的点的总数）之间。
我们使用软件随机生成一个私钥：
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
第二步，使用椭圆曲线算法得出公钥
椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。
在生成私钥
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”
之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：
公钥P.X：
06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385
公钥P.Y：
FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
将上述公钥地址拼合，得到标准地址：
0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB
第三步，计算公钥的SHA-256哈希值
在得到公钥的标准地址：
“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”
后，将该标准地址对齐进行SHA-256哈希计算，得到结果：
“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "了解区块链（2）:比特币的基本架构",
      "item": "https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/understanding-blockchain-02/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "了解区块链（2）:比特币的基本架构",
  "name": "了解区块链（2）:比特币的基本架构",
  "description": "上篇文章在结尾总结到：\n1. 货币需要具有标准化、稀缺性、防伪性，可分割性与耐久性等特征，需要有价值储存功能；\n2. 货币的价值来源于市场中交易者的“共识”而不是货币本身的物理属性。\n本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。\n标准化、可分割性、稀缺性、防伪性、耐久性以及价值存储等特征是一个物品能够成为货币的基础。\n比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。\n在比特币系统中，有交易需求的双方不需要借助任何可信任的第三方（中间方）即可完成点对点的直接交易。\n一、比特币系统的基础设施 1.来自于密码学的非对称加密算法 密码学贯穿于比特币的发行、流通等各环节。\n本文以哈希函数算法为例，其主要特征为：\n单向性。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；\n抗碰撞。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；\n雪崩效应。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这60万字中修改一个标点符号，经过哈希函数算法处理后生成的哈希值都会完全不同；\n隐藏性。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。\n比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终固定为 256 位的二进制数据​​，通常以 ​​64 个字符的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）\n除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。\n2.分布式网络 比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于全球各地的无数台彼此无关的计算机中（也称之为节点）。\n分布式网络能够带来稳定性与自由性。在比特币系统中，即使部分节点失效，系统整体仍可继续运作，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。\n出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：全节点和轻节点。\n全节点保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；\n轻节点并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。\n从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右。\n3.私钥、公钥和地址 在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。地址是实现比特币流转的基础。\n私钥，是比特币系统中对所拥有的比特币所有权本身，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。\n公钥，是一个数学上与私钥配对的公开的信息，是验证数字签名的重要工具。\n地址，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。\n公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。\n私钥、公钥以及地址的具体生成机制如下：\n第一步，系统随机生成私钥\n私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1 ~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4141（即椭圆曲线上的点的总数）之间。\n我们使用软件随机生成一个私钥：\n“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”\n第二步，使用椭圆曲线算法得出公钥\n椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。\n在生成私钥\n“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”\n之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：\n公钥P.X：\n06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385\n公钥P.Y：\nFF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB\n将上述公钥地址拼合，得到标准地址：\n0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB\n第三步，计算公钥的SHA-256哈希值\n在得到公钥的标准地址：\n“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”\n后，将该标准地址对齐进行SHA-256哈希计算，得到结果：\n“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“\n",
  "keywords": [
    
  ],
  "articleBody": "上篇文章在结尾总结到：\n1. 货币需要具有标准化、稀缺性、防伪性，可分割性与耐久性等特征，需要有价值储存功能；\n2. 货币的价值来源于市场中交易者的“共识”而不是货币本身的物理属性。\n本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。\n标准化、可分割性、稀缺性、防伪性、耐久性以及价值存储等特征是一个物品能够成为货币的基础。\n比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。\n在比特币系统中，有交易需求的双方不需要借助任何可信任的第三方（中间方）即可完成点对点的直接交易。\n一、比特币系统的基础设施 1.来自于密码学的非对称加密算法 密码学贯穿于比特币的发行、流通等各环节。\n本文以哈希函数算法为例，其主要特征为：\n单向性。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；\n抗碰撞。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；\n雪崩效应。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这60万字中修改一个标点符号，经过哈希函数算法处理后生成的哈希值都会完全不同；\n隐藏性。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。\n比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终固定为 256 位的二进制数据​​，通常以 ​​64 个字符的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）\n除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。\n2.分布式网络 比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于全球各地的无数台彼此无关的计算机中（也称之为节点）。\n分布式网络能够带来稳定性与自由性。在比特币系统中，即使部分节点失效，系统整体仍可继续运作，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。\n出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：全节点和轻节点。\n全节点保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；\n轻节点并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。\n从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右。\n3.私钥、公钥和地址 在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。地址是实现比特币流转的基础。\n私钥，是比特币系统中对所拥有的比特币所有权本身，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。\n公钥，是一个数学上与私钥配对的公开的信息，是验证数字签名的重要工具。\n地址，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。\n公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。\n私钥、公钥以及地址的具体生成机制如下：\n第一步，系统随机生成私钥\n私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1 ~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4141（即椭圆曲线上的点的总数）之间。\n我们使用软件随机生成一个私钥：\n“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”\n第二步，使用椭圆曲线算法得出公钥\n椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。\n在生成私钥\n“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”\n之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：\n公钥P.X：\n06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385\n公钥P.Y：\nFF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB\n将上述公钥地址拼合，得到标准地址：\n0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB\n第三步，计算公钥的SHA-256哈希值\n在得到公钥的标准地址：\n“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”\n后，将该标准地址对齐进行SHA-256哈希计算，得到结果：\n“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“\n第四步，计算公钥的RIPEMD-160值\n取上一步结果，进行RIPEMD-160计算，得到结果：\n“0b14f003d63ab31aef5fedde2b504699547dd1f6”\n第五步，加入地址版本号\n比特币主网版本号为“0x00”。因此，取上一步结果，在前面加上16进制的00，即：\n“000b14f003d63ab31aef5fedde2b504699547dd1f6”\n第六步，进行双SHA-256计算\n取上一步结果，进行第一次SHA-256计算，可得：\n“ddc2270f93cc84cc6869dd373f3c340bbf5cb9a8f5559297cc9e5d947aab2536”\n接着，对以上结果再次进行SHA-256计算哈希值，得到：\n“869ac57b83ccf75ca9da8895823562fffb611e3c297d9c2d4612aeeb32850078”\n第七步，取第六步结果的前4个字节（8位十六进制）\n“869ac57b”\n第八步，把第七步的4个字节加在第五步结果后面\n作为校验位，将这4个字节加载第五步结果的后面，这就是比特币地址的16进制形态了：\n“000b14f003d63ab31aef5fedde2b504699547dd1f6869ac57b”\n第九步，使用Base58编码生成最终地址\n对上一步的结果进行Base58编码，得到：\n“1QCXRuoxWo5Bya9NxHaVBArBQYhatHJrU7”\n这就是我们经常看到的传统意义上的比特币钱包地址了。\n以上步骤可以简化为下图所示：\n图1 私钥、公钥与地址的关系\n二、比特币的防伪性 所有的货币交易系统最根本的是要保证系统内流通货币的真假问题。系统内流通的“假币”，破坏了整个货币交易系统的信任机制和价值稳定性。笔者认为可以作如下理解——在交易系统中，若出现一枚流通的“假币”，则意味着系统内存在一笔无效的交易或者重复花费的状况，简单来讲，就是系统内存在两枚完全相同的“真币”。但是，在数字货币的系统之中，物理世界的伪造是无法进行的，因此“假币”的问题不会在数字货币系统中出现。然而，却很有可能出现同一个“真币”尝试在系统中用于多笔交易的问题，从而破坏整个系统的信任，我们称这样的问题为“双花问题”。\n在中心化的数字货币支付环境下，所有的交易数据都需经过中心化的清算机构的处理与验证，清算机构有能力确定哪笔交易最先到达，只要确认了最早的交易是唯一有效的，随后相同的交易则会直接被系统拒绝，账户中的“钱”不可能被重复花费，从而解决了“双花问题”。\n然而，由于缺乏中心机构的实时协调，“双花问题”在去中心化的环境中成为一个难题。在比特币系统出现之前，DigiCash、B-Money、Bit Gold和Hashcash等去中心化数字货币系统，因技术限制、中心化依赖、双花问题未解决或市场接受度低而走向失败。\n为了防止交易记录被篡改、“双花问题”等干扰正常交易记录、损害比特币系统信用的行为，比特币创造性的使用了区块链机制。\n区块链机制是一个复杂且宏大的系统，主要包含链式结构、时间戳、分布式系统、PoW共识机制等组成部分。我们先从链式结构开始讲起。\n图2 区块链视图\n1.区块链的链式结构 区块链因其由区块按序连接成链的结构而得名。比特币系统通过程序将区块的生成速度控制在10分钟/个。每一个区块包含区块头和区块体两部分。区块头中包含较多内容，而区块体中则只包含交易信息。\n区块头中有：\n（1）前一区块的哈希值。\n每一个区块都具有哈希值。这个哈希值由版本号、前一个区块的哈希值、默克尔根、时间戳、难度目标、随机数这6个字段（区块头的组成部分）按固定顺序拼接成80字节的二进制数据，再对这80字节的二进制数据进行双SHA-256算法的运算所得到。\n每个区块的哈希值中包含着前一区块的哈希值，由此构成了区块与区块间的链式结构。由于区块的哈希值由包含着交易记录的数据组成，若要修改区块中的交易记录则必然会造成该区块的哈希值改变。在链式结构的模式下，修改一个交易记录需要修改包含该交易记录的区块以及该区块之后的所有区块，加上之后下文中详细写到的工作量证明机制（PoW），修改成本极高。\n（2）默克尔（Merkle）根。\n图3 默克尔根结构示意图\n上图是默克尔根的结构示意图。如图，比特币系统中采用的默克尔根由一个根哈希值、一组中间哈希值和一组叶哈希值组成。\n默克尔根在比特币系统中的设置目的是快速验证交易完整性。如有验证交易的需求，使用者只需在本地对需要验证的交易数据进行比特币系统使用的默克尔根算法计算，得到本地计算出的根哈希值。再将本地计算出的根哈希值与区块中记录的根哈希值进行比对验证，若相同，则交易为真。\n上文 “分布式系统”部分曾提到“轻节点”概念。“轻节点”对某笔交易记录是否存在于区块中的验证利用是区块中的根哈希值。\n轻节点对交易tx进行验证的过程是：\n轻节点为了验证交易tx的真实性，会向全节点请求该交易所对应的​​默克尔路径​​上的相关哈希值。轻节点利用这些哈希值，从交易tx的哈希开始，​​逐层向上计算​​，最终生成一个默克尔根哈希值。若此​​计算得到的根哈希值​​与区块头中所存储的​​官方默克尔根哈希值完全一致​​，即可证明该交易确实被包含在此区块中且未被篡改。\n图4 红框内即为完整默克尔路径\n（3）时间戳。\n时间戳在区块链系统中存在两大作用。\n一是用来记录区块创建时间。时间戳记录了区块生成的大致时间，确保区块链上各区块的时间顺序，防止不同节点记录的区块链出现区块位置不一致的现象。\n二是作为调整难度目标的重要参照指标。比特币协议规定，每个区块的平均生成时间应为10分钟。每隔2016个区块（按照10分钟/区块的速度计算，生成2016个区块大约需要两周时间）网络会通过区块的时间戳根据过去2016个区块的实际生成时间来调整挖矿难度。如果实际生成时间少于两周（挖矿速度过快），难度目标会增加；如果实际生成时间多于两周（挖矿速度过慢），难度目标会降低。\n（4）难度目标。\n根据摩尔定律，人类的算力水平不断在快速的进步。为了实现算力增长与稳定生成区块之间的平衡，比特币系统引入了难度目标机制。难度目标是动态调整的，无论算力有多强，难度目标始终将区块的生成速度稳定在10分钟/个。\n我们可以将难度目标看作是一个阈值，只有当“矿工”计算出的区块哈希小于或等于该区块的难度目标时，区块才被视为有效。比特币系统的难度目标通过**“前导零”的数量**（区块哈希值开头部分连续出现的零的个数）来确定。\n根据比特币协议，比特币系统每2016个区块调整一次难度。若全网算力增长，难度上调，对前导零数量要求增加。比特币系统运行初期，对前导零的数量要求较小，电脑的CPU即能完成区块的产生，从而获得比特币奖励（这一行为称之为“挖矿”）。如今，人们为了“挖到矿”不惜将无数的专门用于“挖矿”的机器（ASIC矿机）连接起来，即使这样，能“挖到矿”的概率也是相当低的。\n（5）随机数。\n哈希函数具有雪崩效应，“矿工”节点需要通过不断调整随机数并进行哈希运算以试出符合“前导零”数量要求的区块哈希值。\n下面，笔者将以比特币创世区块的区块头数据为例，透过实例分析比特币系统区块头的运行逻辑：\n图5 比特币创世区块的区块头数据\n比特币区块头固定为80字节，其他数据如图：\n1.版本号（Version, 4字节）：01000000\n这表示版本号为 1（0x00000001）。作为比特币区块链的创世区块，使用的协议版本为 1。\n2.前一区块哈希值（32字节）：\n由于该区块为创始区块，没有前一个区块，因此全部为0：\n0000000000000000000000000000000000000000000000000000000000000000\n3.默克尔根的根哈希值（32字节）：\n由于创始区块只有一笔来自于打包区块奖励的币基（coinbase）交易，因此默克尔根就是该交易的哈希值：\n3ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a\n我们也可以看到，创始区块的 coinbase 交易包含著名的消息：“The Times 03/Jan/2009 Chancellor on brink of second bailout for banks”（ 《泰晤士报》2009年1月3日 财政大臣即将对银行进行第二次救助）。\n4.时间戳（Timestamp, 4字节）：\n29ab5f49\n对其十进制转换，得到： 1231006505，对应 Unix 时间戳为 2009-01-03 18:15:05 UTC，表明这一区块生成的事件为2009-01-03 18:15:05 UTC。\n5.难度目标（4字节）：\nffff001d\n6.随机数（4字节）：\n1dac2b7c\n也就是说，区块打包者使用的1dac2b7c这一随机数来满足了难度目标对区块哈希值前导零数量的要求。\n2.比特币系统的共识系统——如何在没有中心机构的情况下抵御破坏性攻击？ （1）拜占庭问题\n在去中心化的通讯环境中多个参与者如何达成一致的共识，始终是一个难以解决的问题。有学者将这一系列的问题形象的总结为拜占庭将军问题。拜占庭将军问题解决的基本逻辑是在去中心化的系统中设计一定的容错性，从而整个系统拥有过滤掉破坏节点的能力。\n拜占庭将军问题作出了一个简单的情景假设：一群来自拜占庭帝国的将军围攻一座城市，每位将军指挥一支军队。为了攻下城池，他们必须通过中间人（即信使）协调行动，以决定是统一的行动为“进攻”还是“撤退”。以下为将军们在这样的系统下所面对的状况：\n叛徒行为，有些叛徒将军可能发送非正确的信息，误导他人；\n2.信息延迟，传递信息的信使可能会出现问题，导致将军们可能会收到不一致的信息； 整个系统中的大部分将军必须采取同样的决策，否则整体的行动将会失败。 假设最先提出意见的将军为长官，其他的将军则为副官。为了使叙述更为方便，提前做一些假设：\n第一，所有将军必须执行相同的计划。为此，他们必须相互交换信息以了解彼此的想法；\n第二，副官必须执行所接受到来自长官的命令。\n拜占庭将军们的信息的交流方式有很多种。为了叙述简单，我们将交流方式划分为口头消息和签名消息。\n（a）口头消息，指的是由长官通过口头的方式发送出的信息。在口头消息的传播方式中，消息的内容完全由发送者控制，同时每个人都可以传递任意的内容。\n在叛徒人数小于总人数的1/3的前提下，学者提出了这样的一个解决方案：\n所有的副官接收长官的信息并进行充分的交流，再各自交换信息，并根据获得信息中“大多数人的选择”选择行动方案。如果大家经过交流，没有得到“大多数的选择”（真实的选择可能并不只有“进攻”与“撤退”两项），那么就按照预先约定的选项选择。\n这种解决方案，引入了递归机制（指消息在将军间互相传播了一次），加强了各方的信息掌握程度。通过递归机制，每一个参与者能够了解到所有人的“共识”，从而创造了容错性。\n（b）签名消息，指的是，发出的消息附带上了发送者签名。为了使整个分析更加简单，我们需要做出一些限制性假设：\n第一，签名无法被伪造；\n第二，任何人都可以验证签名的真实性。\n当传递的每一个信息都带上了个人的签名，叛徒将无法伪造忠诚者的消息，整个系统也能够轻易的找出其中的叛徒，从而保证系统的一致性。\n我们假设系统中有三位将军0、1、2，长官0是个叛徒，他对1发出“进攻”的信息，对2发出“撤退”的信息，那么1收到的信息就是“进攻：0”，2收到的消息就是“撤退：0”，互换信息之后，\n1拥有了：“进攻：0”“ 撤退：0：2”，\n2拥有了：“撤退：0”“ 进攻：0：1”\n很明显，收到的信息时不一致的，在这种情况之下，诚实的两位副官依旧可以按照之前约定的行为继续行动，并且可以轻松的判断出0为叛徒。\n同时，在这样的情况下，即使拥有更多的叛徒（只要总人数比叛徒人数多两人，n\u003e=m+2），系统的容错性依旧能被构建起来。\n综上，在分布式系统中解决拜占庭将军问题的要点在于构建容错性，即彼此充分的信息交流和签名的使用，彼此充分的信息交流使得系统中的信息达到透明的状态，增加共识形成的可能性，签名使得系统中非诚实的节点扰乱秩序的成本增加，增强系统的安全性。\n（2）关于工作量证明\n在比特币系统中，各节点需要就区块链的交易顺序和有效性达成一致，而整个系统中可能存在恶意节点，这些节点试图通过双花攻击或篡改交易破坏一致性。因此，在比特币系统内达成共识是非常困难的。\n为了使得比特币系统达成共识，中本聪引工作量证明（PoW）的机制来增加篡改数据所需要的成本，同时结合数字签名和公开账本，解决“拜占庭将军问题”，确保在去中心化系统中能够达成共识。工作量证明机制将共识机制与计算工作量相结合，使得生成区块的权力由节点所完成的工作量决定。也就是说，恶意节点若要篡改交易或发布错误信息，就必须投入比整个网络其他诚实节点更多的计算资源。因此，在比特币系统中，对于想要修改某笔交易的攻击者，需要控制网络中超过50%的算力来重新完成目标区块及其后续所有区块的工作量证明。（这就是“51%攻击”）。\n工作量证明机制起源于对垃圾邮件泛滥的遏制，其底层的逻辑是这样：\n如果一个人愿意花10分钟写一封邮件，那么他就不会在意多花1分钟来证明自己写邮件付出的努力是真实的。但是对于垃圾邮件的发送者来说，每一封邮件都要多花1分钟才能发送，这是完全不可以接受的。也就是说，这样的计算任务对正常用户来说成本是可控的，但对于试图大规模发送垃圾邮件的攻击者来说，计算成本会变得高不可攀。\n工作量证明机制的运行原理，就是通过不断的运算，寻找一个满足当前比特币系统难度目标要求的特定值——即区块哈希值需拥有特定数量的“前导零”。整个网络上最先成功找到该满足条件的哈希值的矿工节点，就赢得了生成该区块的权力，并会获得系统奖励的比特币和交易手续费。\n这种经济激励驱动着越开越多的矿工节点持续投入算力参与竞争。并且随着比特币价值攀升，算力不断增长，网络会动态调整难度目标来维持平均约10分钟/块的区块生成速度。难度目标的不断提升意味着对矿工节点的计算能力要求越来越高，同时，当整个系统所拥有的算力越高时，任何恶意节点想要通过篡改历史交易来重组区块链所需的算力成本变得极其高昂，近乎成为不可能完成的任务，从而确保了区块链的安全性与不可篡改性。\n3.比特币的“最长链”规则 由于节点间存在网络延迟等原因，矿工可能得到同一时间戳的区块，区块链可能出现临时的分叉，从而形成多条竞争链。那么接下来的区块生成竞争中，矿工节点在选择“前一区块哈希值”时将使用哪一个区块的哈希值？\n图6 同时生成两个时间戳相同的区块示意图\n比特币系统使用的是“最长链原则”。根据规则，负责打包交易数据、生产出区块的“矿工”节点始终选择累积工作量最多的区块链作为有效链。\n因为有最大的工作量证明的算力投入到这条链上，“最长链”即代表了绝大多数参与节点的共识。在工作量证明（PoW）的机制下，如果比特币系统中大多数算力被诚实节点控制，那么诚实的链的计算工作量就会增长得最快并超过其他的竞争链。\n攻击者若要修改过去的某区块中的交易数据，则必须重新计算这个区块以及其后的所有区块的工作量证明，还需要赶上并超过诚实节点的工作量证明。\n并且，比特币系统的激励机制会鼓励矿工节点保持诚实——如果一个贪心的攻击者有能力聚集比其他所有诚实节点更多的算力，他将面临修改已有的交易记录还是生成新货币的抉择。在“最长链”原则、工作量证明等机制的作用下，相同算力时，生成新的区块比修改已有的交易收益更大，即遵守规则（生成新的区块）比破坏系统和他自己财产的有效性（修改已有的交易）更有利。\n若如果两个节点同时像比特币网络中的其他节点广播了两个不同的区块，有些节点可能先收到其中一个而其他节点先收到另一个。在这种情况下，其他节点会基于他们收到的第一个区块工作，同时也会保存另一个区块以防止它变为更长的链。当下一个区块被找到后，这种僵局就会被打破，从而使得其中一个区块所代表的分支变得更长，根据“最长链”原则，在另一个分支上工作的节点将切换到更长的链上来。\n“最长链”原则保证了比特币系统的一致性（所有的节点最终在同一个区块链版本上达成共识）、安全性，最重要的是使得系统解决了比特币区块链的暂时分叉问题。\n新区块的广播并不一定能够达到网络上的所有节点。但区块广播是能够容忍消息丢失的，如果某个节点没有收到新产生的某个区块，它将在收到下一个区块的广播后发现它丢失了一个区块然后像其他节点请求这个区块。\n4.比特币系统中的“硬分叉”与“软分叉” 在比特币系统中，所有节点遵循统一的交易数据格式、运行机制等等，从而形成并维护着整个系统的共识。\n因协议升级或规则变更，导致系统中出现了​​新的交易数据格式或运行机制​​，且该变化​​与原有共识规则不兼容​​，使得未升级的节点拒绝接受新规则产生的区块，称为​​**“硬分叉”​​**。此时，网络会分裂成两条独立的链。\n反之，若新规则​​与原有共识兼容​​，未升级节点仍能接受新规则产生的区块，则称为​​“软分叉​​”，在这种状况下，网络不会分裂，仍然保持一条链。\n比特币现金 (BCH) 是硬分叉的典型，而隔离见证（SegWit）则属于软分叉的典型。\n在比特币系统的原始协议中，为追求尽可能小的存储空间，每个​​区块大小被限制为1MB​​。这样的设定严重限制了比特币系统处理交易的速度，导致网络拥堵。面对这种问题，​​比特币核心开发团队​​主张通过“​​隔离见证（SegWit）​​”等方案（将原本为交易ID一部分的签名数据从交易输入中分离，放入一个独立的“见证”结构）进行优化，不直接扩大区块，进行软分叉​​升级。而扩容派​​则认为应直接将​​区块大小提升至8MB​​，​​进行硬分叉​​，以根本性解决扩容问题。\n由于双方无法达成共识，扩容派中以Bitcoin ABC（Adjustable Blocksize Cap）为首的开发团队，基于比特币原链的代码，开发了支持​​8MB区块​​且​​不包含隔离见证（SegWit）功能​​的新客户端软件，随后，支持扩容派的比特币“矿商”约定在比特币主链的​​区块高度478558​​之后执行硬分叉。即当比特币系统生成第478558个区块后，支持分叉的矿工将开始运行新客户端，按照新的规则验证和产生后续区块。最终，​​2017年8月1日​，比特币系统的区块链成功分裂为两条链，一条是沿用原有规则的​​比特币（BTC）链​​，另一条是遵循新规则的​​比特币现金（BCH）链​​。由于​​比特币现金（BCH）链​​分叉于比特币（BTC）链，因此比特币现金（BCH）在分叉点​​完全继承了BTC原链的交易历史​​，也就是说，在分叉时刻之前拥有BTC的用户，在BCH链上也会自动拥有​​等量的BCH，用户只要通过支持BCH的交易所或钱包来申领和操作这些新分叉出来的BCH资产。\n​​隔离见证（SegWit）的“软分叉”升级方式，避免了区块链的永久分裂，未升级的旧节点​​仍然能够验证和接受​​新区块。\n三、比特币的稀缺性 比特币系统的设计之初，设计者中本聪使用三种机制来确保比特币不会滥发。\n一是设定总供应量的限制，\n二是设定“减半”机制逐步减少新币的发行量，\n三是控制比特币发行的速度。\n比特币的总供应量是固定的，2100万枚。这一数量的设定写在比特币系统的源代码之中的，只有通过难以达成的全网共识修改协议，才能进行修改。截至笔者完成本文时，比特币系统已挖出的比特币数量​​约为1980万枚​​，占总供应量2100万枚的约94.3%，​​剩余可挖的比特币仅剩约120万枚​​，占比特币总量不到6%。并且，由于大部分的比特币在其价值较低的时期挖出的，据估计，约有300万至387万枚比特币可能因私钥丢失、硬盘损坏等原因永久丢失。\n此外，中本聪还设定了“减半”时间逐步的减少比特币的发行速度。每210,000个区块（大约每四年），每一个区块中所包含的比特币奖励会减半。到目前为止，比特币已经经历了四次减半，分别在2012年11月28日从50BTC到25BTC、2016年7月9日从25BTC到12.5BTC、2020年5月11日从12.5BTC到6.25BTC、2024年4月19日从6.25BTC到3.125BTC\n图7 比特币减半时间统计\n比特币的产生速度是固定的。上文提到，比特币系统通过设定难度目标、采用工作量证明机制将每一个区块的生成速度控制在10分钟左右。由于区块奖励是比特币的生成的唯一途径，因此，比特币的产生速度也在每10分钟左右。\n实际上，比特币系统对于矿工节点的激励包括生成区块所创造的比特币和交易费两种形式。\n生成区块所创造的比特币指的就是源于生成区块的币基（coinbase）奖励，而交易费则源自——一笔未花费交易输出（UTXO）的输出值小于其输入值，两者的差价就作为交易费作为包含此交易的区块对于生成次区块的矿工节点的激励中。\n当比特币的2100万枚在2140年被全部挖掘完毕后，比特币的总量将不再增加，生成区块所创造的比特币不在出现，区块链系统对于矿工节点的奖励来自于每一笔交易多出来的交易费。同时，矿工节点可以根据交易费的多少来决定打包交易的先后顺序。这样的机制确保比特币系统能够长期以去中心化的模式运行下去。\n四、比特币的标准化、可分割性与耐久性 比特币系统采用的是分布式系统，比特币的交易记录遍布全球各个节点。由于全球各地各节点的一致的认可，比特币作为一种资产在全球范围内都具有一致的价值和特征。\n作为由编程创造的数字货币，相较于在现实世界发行的法定货币或者其他实物货币，比特币具有天然的可分割特性。其最小的单位是聪”（Satoshi），与比特币的换算单位为：1 BTC = 1亿聪（1 Satoshi（聪） = 0.00000001 BTC）。当然，只要比特币系统能够经过社区达成修改协议硬性规定的共识，比特币还可以产生出更小的单位，理论上具有无限的分割性。\n比特币存在于区块链上，是一种数字资产，不像实物货币（如纸币或金属币）会因物理磨损而失去价值。只要区块链网络运行，比特币就始终存在。同时，自2009年比特币网络启动以来，由于其去中心化的特性，比特币系统未曾因技术故障而停止运行，证明了其系统的鲁棒性和耐久性。\n五、在比特币系统中的交易 1.基于交易的“记账”模型——未花费的交易输出(Unspent Transaction Outputs，UTXO) 每个人都早已习惯基于账户的记账方式。日常生活中每个人脑子中都存在一个余额系统，我们记住了我们的账户入账了多少，出账了多少，通过数学的运算，我们最后的记忆落在了账户中还剩下多少上。但与我们日常的直觉不同，比特币系统并未采用基于账户的记账模型，而是采用基于交易的模型，学名叫做“未花费交易输出”（Unspent Transaction Output, UTXO）。\n在基于交易的模型中，每个交易由交易输入和交易输出两个部分组成，交易输入和交易输出可以同时记录多条不同的交易，如下图：\n图8 比特币交易的数据结构\n交易中的输入部分主要由上笔交易的哈希PrevTxHash、上笔交易的输出索引Index（输入部分所指向的之前交易的，也就是交易比特币的来源）和输入脚本ScriptSig（证明所交易的比特币使用权的​​凭证​​）组成。\n对于交易输出的结构，每个输出包括转账金额Value和包含接收者公钥哈希的脚本Script-PubKey。\n在基于交易的模型中，每一笔交易都通过在输入部分写入上一笔交易的哈希值，构成以交易为节点的链式结构。这种设计使得任意一笔比特币交易都可以向前追溯至其源头——即币基（coinbase）交易（由挖矿生成的比特币），并向后追踪至尚未被花费的交易输出（UTXO）。如果一笔交易的输出没有任何另一笔交易的输入与之对应，则说明该输出中的比特币未被花费。\n通过收集当前所有未花费的交易输出(Unspent Transaction Outputs，UTXO)，可快速验证某交易中的比特币是否已花费。针对某一比特币地址，其所有未花费交易的比特币之和，就是该账户的比特币余额。\n基于交易的模型可有效地防范伪造、双花等针对去中心化数字货币系统的攻击。更重要的是，相较于基于账户的传统交易计算方式，比特币系统采用的基于交易的模型有效的节约了计算、存储资源，推动了比特币系统的普及，如上文中所提到，从2009年的创世区块至今，比特币的全节点储存的数据大约为650GB，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在80-100MB左右，相比之下，大型银行的存储由于存储了账户余额、交易明细以及为支持这些业务产生的庞大日志、审计和合规数据，10年核心系统数据总量达到PB级别是非常正常的​​。\n2. 比特币的交易过程 图9 比特币的交易过程\n以上为比特币交易的过程。为了方便理解，本处使用（杨晓晨，2014）中的叙述来进行阐释：“交易单1中其实包含以下六种信息：\n一是交易单1的ID；\n二是资金的来源，即交易单0的ID；\n三是A对资金的签名，以证明是他把100BTC给B的；\n四是资金的去向，即C的账号（公钥）；\n五是资金的数额，即100 BTC；\n六是B的签名（即B用自己私钥进行的数字签名），以证明是他自己签发的交易。\n由于每笔交易单都记录了该笔资金的前一个拥有者、当前拥有者以及后一个拥有者，我们就可以依据交易单实现对资金的全程追溯。\n最后，当每一笔交易完成时，系统都会向全网进行广播，告诉所有用户这笔交易的实施。”\n3.还没被打包进区块的交易在哪？——关于内存池（Mempool） 在比特币系统中，还没有被矿工节点选中被打包进区块中的交易都会被存放在内存池（Mempool）中。​​内存池（Mempool）是比特币系统的缓冲区和调度中心​​，系统中所有未被确认、未被打包进区块的交易都在内存池中暂存并进行排序。\n内存池中的交易主要按手续费率（每字节聪数）来进行排序，矿工节点将会优先打包高费率交易。值得一提的是，比特币系统还曾采用优先级（优先级 = (SUM(输入金额 * 输入年龄)) / 交易大小（字节））作为辅助排序标准，来避免低手续费或零手续费交易长期未被确认的问题。\n六、总结——比特币系统运行的全过程 作为一套尝试用数学信用对抗国家强权背书（国家信用）的金融系统，比特币系统通过融合使用密码学、分布式网络和经济学原理，成功构建了一个​​去中心化、安全且稀缺​​的数字货币系统。\n根据文献及笔者已有认知，现对比特币系统基本架构作以下四个层面的概括：\n​​1.密码学基础层​​​​：\n通过​​非对称加密​​和​​哈希函数​​等密码学算法确保所有权验证和交易完整性。\n2.分布式网络层​​​​：\n通过运用遍布全球的分布式网络体系，使得系统​​中所有节点能够在没有中心服务器的状态下，平等参与系统的运行，达成统一共识。\n3.共识与安全层​​​​：\n​​工作量证明​​（PoW）：通过促使各矿工节点投入算力计算满足难度目标（“前导零”数量要求）的区块哈希值竞争记账权，消耗算力来抵御51%攻击。\n最长链原则​​：自动选择累积工作量最大的链为主链，解决临时分叉问题，从而确保全网最终一致性节点。\n未花费输出（UTXO）模型：采用与基于账户的记账方式不同的基于交易的记账方式，每笔交易的比特币都消耗先前未花费输出，并生成新输出，从而能够达到追溯至比特币来源、全网节点验证其唯一性的目的。\n4.经济与治理层​​​​：\n稀缺性机制：固定总量为2100万枚，通过每4年奖励减半来控制发行速率。2140年区块奖励归零后，矿工节点的激励则来源于交易的交易费。\n比特币系统的本质是一套​​基于数学和共识的信任系统​​，其取代了传统金融的中心化权威。其架构为区块链技术提供了范式，推动了去中心化金融的创新与发展。在笔者看来，其设计巧妙之处在于：\n（1）多学科融合：比特币融合密码学与经济学等多学科内容，从解决实际问题的角度设置系统，打破传统的学术思维习惯。\n（2）激励相容​​：矿工在激励下投入算力维护网络安全，以获得区块奖励和交易费。整个过程中，其个人利益与系统健康运行的利益一致。即使面临破坏系统的策略，比特币系统通过激励机制的分配，能够确保诚实的挖矿节点因经济回报更高而占主导，进一步保证系统长期运行的可持续性。\n（3）鲁棒性​​：分布式存储和共识机制使比特币系统具有抗单点故障和攻击的能力，区块链数据储存于分布于全球的不同节点中，确保比特币系统能够持续运行并具备高度抗审查的特性。\n（4）可验证性：任何节点可验证比特币系统中交易和区块的合法性，达到增强系统的透明度和去信任化特性的目的。\n（5）去中心化治理：比特币系统通过社区共识实现协议升级，系统中不存在中央权威控制，全部通过社区共识对比特币系统进行治理。\n截至本文完成时，比特币价格已经达到$112,000。\n笔者认为这足以证明比特币系统存在的价值。下一篇文章，笔者将对比特币系统的价值做出主观、粗略的判断。\n参考文献\nhttps://bitcoin.org/bitcoin.pdf\nhttps://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf\nhttp://blockchain.mit.edu/how-blockchain-works/\nhttps://liaoxuefeng.com/books/blockchain/bitcoin/p2p/public-key/index.html\nhttps://www.zhihu.com/column/p/28036845\nhttps://www.bilibili.com/video/BV1WM411y7Vf?vd_source=d96e19e5f16193c9ab4bbdd870870971\nhttps://zhuanlan.zhihu.com/p/128097006\nhttps://cloud.tencent.com/developer/article/1141901\nLamport L, Shostak R, Pease M. The Byzantine generals problem[M]//Concurrency: the works of leslie lamport. 2019: 203-226.\n杨晓晨,张明.比特币:运行原理、典型特征与前景展望[J].金融评论,2014,6(01):38-53+124.\n贾丽平.比特币的理论、实践与影响[J].国际金融研究,2013,(12):14-25.\n邵奇峰,金澈清,张召,等.区块链技术:架构及进展[J].计算机学报,2018,41(05):969-988.\n袁勇,王飞跃.区块链技术发展现状与展望[J].自动化学报,2016,42(04):481-494.DOI:10.16383/j.aas.2016.c160158.\n沈鑫,裴庆祺,刘雪峰.区块链技术综述[J].网络与信息安全学报,2016,2(11):11-20.\n",
  "wordCount" : "355",
  "inLanguage": "en",
  "datePublished": "2025-09-09T10:00:00+08:00",
  "dateModified": "2025-09-09T10:00:00+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/%E7%A0%94%E7%A9%B6%E6%8A%A5%E5%91%8A/understanding-blockchain-02/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Leo",
    "logo": {
      "@type": "ImageObject",
      "url": "https://yuhengliuleo.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://yuhengliuleo.github.io/" accesskey="h" title="Leo (Alt + H)">Leo</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://yuhengliuleo.github.io/%E5%88%86%E7%B1%BB/" title="分类">
                    <span>分类</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      了解区块链（2）:比特币的基本架构
    </h1>
    <div class="post-meta"><span title='2025-09-09 10:00:00 +0800 CST'>September 9, 2025</span>

</div>
  </header> 
  <div class="post-content"><p>上篇文章在结尾总结到：</p>
<p>1.
货币需要具有<strong>标准化</strong>、<strong>稀缺性</strong>、<strong>防伪性</strong>，<strong>可分割性与耐久性</strong>等特征，需要有<strong>价值储存功能</strong>；</p>
<p>2. 货币的价值来源于市场中交易者的“<strong>共识</strong>”而不是货币本身的物理属性。</p>
<p>本篇文章，笔者将以上述货币特征为主线，详细解析比特币的基本架构。</p>
<p><strong>标准化</strong>、<strong>可分割性</strong>、<strong>稀缺性</strong>、<strong>防伪性</strong>、<strong>耐久性</strong>以及<strong>价值存储</strong>等特征是一个物品能够成为货币的基础。</p>
<p>比特币系统，一个“去中心化”理念的实践产物，以数学作为其信用来源，自2009年运行至今。相较于传统中心化金融系统，比特币系统没有也不需要依赖任何中心清算机构即可完成系统内流通物比特币的产生发行、交易流通、结算等过程。</p>
<p>在比特币系统中，有交易需求的双方<strong>不需要借助任何可信任的第三方</strong>（中间方）即可完成点对点的直接交易。</p>
<h2 id="一比特币系统的基础设施">一、比特币系统的基础设施<a hidden class="anchor" aria-hidden="true" href="#一比特币系统的基础设施">#</a></h2>
<h3 id="1来自于密码学的非对称加密算法">1.来自于密码学的非对称加密算法<a hidden class="anchor" aria-hidden="true" href="#1来自于密码学的非对称加密算法">#</a></h3>
<p>密码学贯穿于比特币的发行、流通等各环节。</p>
<p>本文以哈希函数算法为例，其主要特征为：</p>
<ol>
<li>
<p><strong>单向性</strong>。任何数据（X）经过哈希函数算法处理后都可以转换成固定长度的哈希值「Hash（X）」，但却很难从已知的哈希值「Hash（X）」反推出哈希函数算法处理前的X是什么。例如，我们可以将一部《西游记》经过哈希运算转换成一串哈希值，但是不可能根据这样的一串哈希值来复原出《西游记》；</p>
</li>
<li>
<p><strong>抗碰撞</strong>。对于不同的两种数据，经过哈希函数算法处理后生成相同哈希值的概率极低，计算上几乎不可行；</p>
</li>
<li>
<p><strong>雪崩效应</strong>。量变产生质变，只要数据（X）稍有变化，经过哈希运算的哈希值「Hash（X）」将会发生巨变。继续以《西游记》举例，《西游记》总共约60万字，但只要这<strong>60万字中修改一个标点符号</strong>，经过哈希函数算法处理后生成的哈希值<strong>都会完全不同</strong>；</p>
</li>
<li>
<p><strong>隐藏性</strong>。即使知道哈希值「Hash（X）」的一部分和X的一部分，知道X的剩余部分依旧是非常困难的。以《西游记》举例，即使我们已经知道了过哈希函数算法处理后生成的哈希值和《西游记》的一部分章节，但是对于剩下未知的章节，我们依旧需要大量的几乎不可能完成的尝试才能得到剩余的部分。</p>
</li>
</ol>
<p>比特币系统使用的哈希函数中为SHA-256算法。SHA-256算法，指的是无论输入数据的长短，输出的哈希值长度始终<strong>固定为
256 位</strong>的二进制数据​​，通常以 <strong>​​64
个字符</strong>的十六进制字符串的形式来表示。（十六进制的每一位字符可单独转换为对应的4位二进制数）</p>
<p>除了哈希函数的SHA-256算法外，比特币系统还使用了哈希函数的RIPEMD-160算法、椭圆曲线加密（ECC）中的secp256k1曲线以及默克尔根等密码学技术。</p>
<h3 id="2分布式网络">2.分布式网络<a hidden class="anchor" aria-hidden="true" href="#2分布式网络">#</a></h3>
<p>比特币系统作为“去中心化”系统，其中所有交易记录并不集中储存在中心化的服务器中，而是完整的保存在分布于<strong>全球各地的无数台彼此无关的计算机</strong>中（也称之为节点）。</p>
<p>分布式网络能够带来<strong>稳定性</strong>与<strong>自由性</strong>。在比特币系统中，<strong>即使部分节点失效，系统整体仍可继续运作</strong>，高度分散化的交易信息存储，使得比特币主区块链完全遗失的可能性微乎其微。而在中心化的金融系统中，一旦中心的服务器出现宕机等等的故障，将导致极大的经济损失，必须要在平时花费大量的人力物力进行维护。</p>
<p>出于安全性与实用性平衡的考虑，比特币系统中存在两种不同的节点类型：<strong>全节点</strong>和<strong>轻节点</strong>。</p>
<p><strong>全节点</strong>保存了比特币从创世块到最新块的完整交易历史和数据，可以独立的验证每笔交易或区块是否符合比特币协议规则；<br>
<strong>轻节点</strong>并不储存完整的区块链，只是保存部分的数据，储存的内容明显少于全节点，并且，其在查询并验证特定交易是否包含在区块链的过程中需要依靠全节点。</p>
<p>从2009年的创世区块至今，比特币的<strong>全节点储存的数据大约为650GB</strong>，相比之下，由于<strong>轻节点</strong>不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在<strong>80-100MB左右</strong>。</p>
<h3 id="3私钥公钥和地址">3.私钥、公钥和地址<a hidden class="anchor" aria-hidden="true" href="#3私钥公钥和地址">#</a></h3>
<p>在比特币系统中，每个节点都包含一个或多个“地址”，地址由私钥、公钥经过一系列算法处理后生成。类似于银行卡账号，使用者通过地址来发送和接收比特币。<strong>地址是实现比特币流转的基础</strong>。</p>
<p><strong>私钥，是比特币系统中对所拥有的比特币所有权本身</strong>，在交易中，需要使用私钥对交易进行数字签名以证明对交易的比特币的所有权。私钥是唯一的，不可替代的，如果私钥丢失，比特币将永远丢失。<br>
<strong>公钥</strong>，是一个数学上与私钥配对的公开的信息，是<strong>验证数字签名的重要工具。<br>
地址</strong>，相当于银行系统中的银行卡卡号，负责处理转账的目标、信息等等。</p>
<p>公钥和私钥是一对。每一个比特币系统的使用者都有着属于自己的私钥和公钥，公钥对外公开，私钥则由自己保密。私钥用于生成交易的数字签名，证明所有权；公钥用于验证签名的有效性，确保交易未被篡改。</p>
<p>私钥、公钥以及地址的具体生成机制如下：</p>
<p>第一步，系统随机生成私钥<br>
私钥是一个计算机随机生成的数字。计算机系统随机选取一个32字节的数，且这个数介于1
~ 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2
5E8C D036 4141（即椭圆曲线上的点的总数）之间。<br>
我们使用软件随机生成一个私钥：<br>
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”</p>
<p>第二步，使用椭圆曲线算法得出公钥<br>
椭圆曲线加密算法，也是非对称加密算法的一种。私钥经过该算法的运算后产生公钥。与上文列举的哈希算法相似，从公钥反向推导出私钥是几乎不可能的。</p>
<p>在生成私钥<br>
“8F72F6B29E6E225A36B68DFE333C7CE5E55D83249D3D2CD6332671FA445C4DD3”<br>
之后，我们使用椭圆曲线加密算法（ECDSA-secp256k1）计算私钥所对应的非压缩公钥。生成的公钥共65字节，共分为X和Y两段：<br>
公钥P.X：<br>
06CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385<br>
公钥P.Y：<br>
FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB<br>
将上述公钥地址拼合，得到标准地址：<br>
0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB</p>
<p>第三步，计算公钥的SHA-256哈希值<br>
在得到公钥的标准地址：<br>
“0406CCAE7536386DA2C5ADD428B099C7658814CA837F94FADE365D0EC6B1519385FF83EC5F2C0C8F016A32134589F7B9E97ACBFEFD2EF12A91FA622B38A1449EEB”<br>
后，将该标准地址对齐进行SHA-256哈希计算，得到结果：<br>
“2572e5f4a8e77ddf5bb35b9e61c61f66455a4a24bcfd6cb190a8e8ff48fc097d“</p>
<p>第四步，计算公钥的RIPEMD-160值<br>
取上一步结果，进行RIPEMD-160计算，得到结果：<br>
“0b14f003d63ab31aef5fedde2b504699547dd1f6”</p>
<p>第五步，加入地址版本号<br>
比特币主网版本号为“0x00”。因此，取上一步结果，在前面加上16进制的00，即：<br>
“000b14f003d63ab31aef5fedde2b504699547dd1f6”</p>
<p>第六步，进行双SHA-256计算<br>
取上一步结果，进行第一次SHA-256计算，可得：<br>
“ddc2270f93cc84cc6869dd373f3c340bbf5cb9a8f5559297cc9e5d947aab2536”<br>
接着，对以上结果再次进行SHA-256计算哈希值，得到：<br>
“869ac57b83ccf75ca9da8895823562fffb611e3c297d9c2d4612aeeb32850078”</p>
<p>第七步，取<strong>第六步</strong>结果的前4个字节（8位十六进制）<br>
“869ac57b”</p>
<p>第八步，把<strong>第七步</strong>的4个字节加在第五步结果后面<br>
作为校验位，将这4个字节加载第五步结果的后面，这就是比特币地址的16进制形态了：<br>
“000b14f003d63ab31aef5fedde2b504699547dd1f6869ac57b”</p>
<p>第九步，使用Base58编码<strong>生成最终地址</strong><br>
对上一步的结果进行Base58编码，得到：<br>
“1QCXRuoxWo5Bya9NxHaVBArBQYhatHJrU7”</p>
<p>这就是我们经常看到的传统意义上的比特币钱包地址了。</p>
<p>以上步骤可以简化为下图所示：</p>
<p><img alt="图1 私钥、公钥与地址的关系" loading="lazy" src="/media/bitcoin1/1.JPG">
图1 私钥、公钥与地址的关系</p>
<h2 id="二比特币的防伪性">二、比特币的防伪性<a hidden class="anchor" aria-hidden="true" href="#二比特币的防伪性">#</a></h2>
<p>所有的货币交易系统最根本的是要保证系统内流通货币的真假问题。系统内流通的“假币”，破坏了整个货币交易系统的信任机制和价值稳定性。笔者认为可以作如下理解——<strong>在交易系统中，若出现一枚流通的“假币”，则意味着系统内存在一笔无效的交易或者重复花费的状况，简单来讲，就是系统内存在两枚完全相同的“真币”。<strong>但是，在数字货币的系统之中，物理世界的伪造是无法进行的，因此“假币”的问题不会在数字货币系统中出现。然而，却很有可能出现同一个“真币”尝试在系统中用于多笔交易的问题，从而破坏整个系统的信任，我们称这样的问题为</strong>“双花问题”</strong>。</p>
<p>在中心化的数字货币支付环境下，所有的交易数据都需经过中心化的清算机构的处理与验证，<strong>清算机构有能力确定哪笔交易最先到达</strong>，只要确认了最早的交易是唯一有效的，随后相同的交易则会直接被系统拒绝，账户中的“钱”不可能被重复花费，从而解决了“双花问题”。</p>
<p>然而，由于缺乏中心机构的实时协调，“双花问题”在去中心化的环境中成为一个难题。在比特币系统出现之前，DigiCash、B-Money、Bit
Gold和Hashcash等去中心化数字货币系统，因技术限制、中心化依赖、双花问题未解决或市场接受度低而走向失败。</p>
<p>为了防止交易记录被篡改、“双花问题”等干扰正常交易记录、损害比特币系统信用的行为，比特币创造性的使用了<strong>区块链机制</strong>。</p>
<p>区块链机制是一个复杂且宏大的系统，主要包含链式结构、时间戳、分布式系统、PoW共识机制等组成部分。我们先从链式结构开始讲起。</p>
<p><img alt="图2 区块链视图" loading="lazy" src="/media/bitcoin1/2.JPG">
图2 区块链视图</p>
<h3 id="1区块链的链式结构">1.区块链的链式结构<a hidden class="anchor" aria-hidden="true" href="#1区块链的链式结构">#</a></h3>
<p>区块链因其由区块按序连接成链的结构而得名。比特币系统通过程序将区块的生成速度控制在10分钟/个。每一个区块包含<strong>区块头</strong>和<strong>区块体</strong>两部分。区块头中包含较多内容，而区块体中则只包含交易信息。</p>
<p>区块头中有：</p>
<p><strong>（1）前一区块的哈希值。</strong></p>
<p>每一个区块都具有哈希值。这个哈希值由<strong>版本号</strong>、<strong>前一个区块的哈希值</strong>、<strong>默克尔根</strong>、<strong>时间戳</strong>、<strong>难度目标</strong>、<strong>随机数</strong>这6个字段（区块头的组成部分）按固定顺序拼接成80字节的二进制数据，再对这80字节的二进制数据进行双SHA-256算法的运算所得到。</p>
<p><strong>每个区块的哈希值中包含着前一区块的哈希值</strong>，由此构成了区块与区块间的链式结构。由于区块的哈希值由包含着交易记录的数据组成，<strong>若要修改区块中的交易记录则必然会造成该区块的哈希值改变</strong>。在链式结构的模式下，修改一个交易记录需要修改包含该交易记录的区块以及该区块之后的所有区块，加上之后下文中详细写到的工作量证明机制（PoW），修改成本极高。</p>
<p><strong>（2）默克尔（Merkle）根。</strong></p>
<p><img alt="图3 默克尔根结构示意图" loading="lazy" src="/media/bitcoin1/3.JPG">
图3 默克尔根结构示意图</p>
<p>上图是默克尔根的结构示意图。如图，比特币系统中采用的<strong>默克尔根由一个根哈希值、一组中间哈希值和一组叶哈希值组成</strong>。</p>
<p><strong>默克尔根在比特币系统中的设置目的是快速验证交易完整性</strong>。如有验证交易的需求，使用者只需在本地对需要验证的交易数据进行比特币系统使用的默克尔根算法计算，得到本地计算出的根哈希值。再将本地计算出的根哈希值与区块中记录的根哈希值进行比对验证，若相同，则交易为真。</p>
<p>上文
“分布式系统”部分曾提到“轻节点”概念。“轻节点”对某笔交易记录是否存在于区块中的验证利用是区块中的根哈希值。</p>
<p>轻节点对交易tx进行验证的过程是：<br>
轻节点为了验证交易tx的真实性，会<strong>向全节点请求</strong>该交易所对应的​​默克尔路径​​上的相关哈希值。轻节点利用这些哈希值，从交易tx的哈希开始，​​<strong>逐层向上计算​​</strong>，最终<strong>生成一个默克尔根哈希值</strong>。若此​​计算得到的根哈希值​​与区块头中所存储的​​官方默克尔根哈希值完全一致​​，即可证明该交易确实被包含在此区块中且未被篡改。</p>
<p><img alt="图4 红框内即为完整默克尔路径" loading="lazy" src="/media/bitcoin1/4.JPG">
图4 红框内即为完整默克尔路径</p>
<p><strong>（3）时间戳。</strong></p>
<p>时间戳在区块链系统中存在两大作用。</p>
<p>一是用来<strong>记录区块创建时间</strong>。时间戳记录了区块生成的大致时间，确保区块链上各区块的时间顺序，防止不同节点记录的区块链出现区块位置不一致的现象。</p>
<p>二是<strong>作为调整难度目标的重要参照指标</strong>。比特币协议规定，每个区块的平均生成时间应为10分钟。每隔2016个区块（按照10分钟/区块的速度计算，生成2016个区块大约需要两周时间）网络会通过区块的时间戳根据过去2016个区块的实际生成时间来调整挖矿难度。如果实际生成时间少于两周（挖矿速度过快），难度目标会增加；如果实际生成时间多于两周（挖矿速度过慢），难度目标会降低。</p>
<p><strong>（4）难度目标。</strong></p>
<p>根据摩尔定律，人类的算力水平不断在快速的进步。为了实现算力增长与稳定生成区块之间的平衡，比特币系统引入了难度目标机制。难度目标是动态调整的，无论算力有多强，难度目标始终将区块的生成速度稳定在10分钟/个。</p>
<p>我们可以将难度目标看作是一个阈值，只有当“矿工”计算出的区块哈希小于或等于该区块的难度目标时，区块才被视为有效。比特币系统的<strong>难度目标</strong>通过**“前导零”的数量**（区块哈希值开头部分连续出现的零的个数）来确定。</p>
<p>根据比特币协议，比特币系统<strong>每2016个区块调整一次难度</strong>。若全网算力增长，难度上调，对前导零数量要求增加。比特币系统运行初期，对前导零的数量要求较小，电脑的CPU即能完成区块的产生，从而获得比特币奖励（这一行为称之为“挖矿”）。如今，人们为了“挖到矿”不惜将无数的专门用于“挖矿”的机器（ASIC矿机）连接起来，即使这样，能“挖到矿”的概率也是相当低的。</p>
<p><strong>（5）随机数。</strong></p>
<p>哈希函数具有<strong>雪崩效应</strong>，“矿工”节点需要通过不断调整随机数并进行哈希运算以试出符合“前导零”数量要求的区块哈希值。</p>
<p>下面，笔者将以<strong>比特币创世区块的区块头数据</strong>为例，透过实例分析比特币系统区块头的运行逻辑：</p>
<p><img alt="图5 比特币创世区块的区块头数据" loading="lazy" src="/media/bitcoin1/5.JPG">
图5 比特币创世区块的区块头数据</p>
<p>比特币区块头固定为80字节，其他数据如图：</p>
<p>1.<strong>版本号</strong>（Version, 4字节）：01000000<br>
这表示版本号为 1（0x00000001）。作为比特币区块链的创世区块，使用的协议版本为
1。</p>
<p>2.<strong>前一区块哈希值</strong>（32字节）：<br>
由于该区块为创始区块，没有前一个区块，因此全部为0：<br>
0000000000000000000000000000000000000000000000000000000000000000</p>
<p>3.<strong>默克尔根的根哈希值</strong>（32字节）：<br>
由于创始区块只有一笔来自于打包区块奖励的币基（coinbase）交易，因此默克尔根就是该交易的哈希值：<br>
3ba3edfd7a7b12b27ac72c3e67768f617fc81bc3888a51323a9fb8aa4b1e5e4a</p>
<p>我们也可以看到，创始区块的 coinbase 交易包含著名的消息：“The Times
03/Jan/2009 Chancellor on brink of second bailout for banks”（
《泰晤士报》2009年1月3日 财政大臣即将对银行进行第二次救助）。</p>
<p>4.<strong>时间戳</strong>（Timestamp, 4字节）：<br>
29ab5f49<br>
对其十进制转换，得到： 1231006505，对应 Unix 时间戳为 2009-01-03
18:15:05 UTC，表明这一区块生成的事件为2009-01-03 18:15:05 UTC。</p>
<p>5.<strong>难度目标</strong>（4字节）：<br>
ffff001d</p>
<p>6.<strong>随机数</strong>（4字节）：<br>
1dac2b7c<br>
也就是说，区块打包者使用的1dac2b7c这一随机数来满足了难度目标对区块哈希值前导零数量的要求。</p>
<h3 id="2比特币系统的共识系统如何在没有中心机构的情况下抵御破坏性攻击">2.比特币系统的共识系统——如何在没有中心机构的情况下抵御破坏性攻击？<a hidden class="anchor" aria-hidden="true" href="#2比特币系统的共识系统如何在没有中心机构的情况下抵御破坏性攻击">#</a></h3>
<p><strong>（1）拜占庭问题</strong></p>
<p>在去中心化的通讯环境中<strong>多个参与者如何达成一致的共识</strong>，始终是一个难以解决的问题。有学者将这一系列的问题形象的总结为拜占庭将军问题。拜占庭将军问题<strong>解决的基本逻辑</strong>是在去中心化的系统中<strong>设计一定的容错性</strong>，从而整个系统<strong>拥有过滤掉破坏节点的能力</strong>。</p>
<p>拜占庭将军问题作出了一个简单的情景假设：一群来自拜占庭帝国的将军围攻一座城市，每位将军指挥一支军队。为了攻下城池，他们必须通过中间人（即信使）协调行动，以决定是统一的行动为“进攻”还是“撤退”。以下为将军们在这样的系统下所面对的状况：</p>
<ol>
<li>叛徒行为，有些叛徒将军可能发送非正确的信息，误导他人；<br>
2.信息延迟，传递信息的信使可能会出现问题，导致将军们可能会收到不一致的信息；</li>
<li>整个系统中的大部分将军必须采取同样的决策，否则整体的行动将会失败。</li>
</ol>
<p>假设<strong>最先提出意见</strong>的将军为<strong>长官</strong>，<strong>其他的</strong>将军则为<strong>副官</strong>。为了使叙述更为方便，提前做一些假设：<br>
第一，所有将军必须执行相同的计划。为此，他们必须相互交换信息以了解彼此的想法；<br>
第二，副官必须执行所接受到来自长官的命令。</p>
<p>拜占庭将军们的信息的交流方式有很多种。为了叙述简单，我们将交流方式划分为<strong>口头消息</strong>和<strong>签名消息</strong>。</p>
<p>（a）<strong>口头消息</strong>，指的是由长官通过<strong>口头</strong>的方式发送出的信息。在口头消息的传播方式中，消息的内容完全由发送者控制，同时每个人都可以传递任意的内容。</p>
<p>在叛徒人数小于总人数的1/3的前提下，学者提出了这样的一个解决方案：<br>
所有的副官接收长官的信息并进行充分的交流，再各自交换信息，并根据获得信息中“大多数人的选择”选择行动方案。如果大家经过交流，没有得到“大多数的选择”（真实的选择可能并不只有“进攻”与“撤退”两项），<strong>那么就按照预先约定的选项选择。</strong></p>
<p>这种解决方案，引入了递归机制（指消息在将军间互相传播了一次），加强了各方的信息掌握程度。通过递归机制，每一个参与者能够了解到所有人的“共识”，从而创造了<strong>容错性</strong>。</p>
<p>（b）<strong>签名消息</strong>，指的是，发出的消息附带上了发送者签名。为了使整个分析更加简单，我们需要做出一些限制性假设：<br>
第一，签名无法被伪造；<br>
第二，任何人都可以验证签名的真实性。</p>
<p>当传递的每一个信息都带上了个人的签名，叛徒将无法伪造忠诚者的消息，整个系统也能够轻易的找出其中的叛徒，从而保证系统的一致性。<br>
我们假设系统中有三位将军0、1、2，长官0是个叛徒，他对1发出“进攻”的信息，对2发出“撤退”的信息，那么1收到的信息就是“进攻：0”，2收到的消息就是“撤退：0”，互换信息之后，<br>
1拥有了：“进攻：0”“ 撤退：0：2”，<br>
2拥有了：“撤退：0”“ 进攻：0：1”<br>
很明显，收到的信息时不一致的，在这种情况之下，诚实的两位副官依旧可以按照之前约定的行为继续行动，并且可以轻松的判断出0为叛徒。</p>
<p>同时，在这样的情况下，即使拥有更多的叛徒（只要总人数比叛徒人数多两人，n&gt;=m+2），系统的容错性依旧能被构建起来。</p>
<p>综上，在分布式系统中解决拜占庭将军问题的<strong>要点在于构建容错性</strong>，即<strong>彼此充分的信息交流和签名的使用</strong>，彼此充分的信息交流使得系统中的信息达到透明的状态，增加共识形成的可能性，签名使得系统中非诚实的节点扰乱秩序的成本增加，增强系统的安全性。</p>
<p><strong>（2）关于工作量证明</strong></p>
<p>在比特币系统中，各节点需要就区块链的交易顺序和有效性达成一致，而整个系统中可能存在恶意节点，这些节点试图通过双花攻击或篡改交易破坏一致性。因此，在比特币系统内达成共识是非常困难的。</p>
<p>为了使得比特币系统达成共识，中本聪引<strong>工作量证明（PoW）<strong>的机制来增加篡改数据所需要的成本，同时结合数字签名和公开账本，解决“拜占庭将军问题”，确保在去中心化系统中能够达成共识。工作量证明机制将共识机制与计算工作量相结合，使得生成区块的权力由</strong>节点所完成的工作量</strong>决定。也就是说，恶意节点若要篡改交易或发布错误信息，就必须投入比整个网络其他诚实节点更多的计算资源。因此，在比特币系统中，对于想要修改某笔交易的攻击者，需要控制网络中超过50%的算力来重新完成目标区块及其后续所有区块的工作量证明。<strong>（这就是“51%攻击”）。</strong></p>
<p>工作量证明机制起源于对垃圾邮件泛滥的遏制，其底层的逻辑是这样：<br>
如果一个人愿意花10分钟写一封邮件，那么他就不会在意多花1分钟来证明自己写邮件付出的努力是真实的。但是对于垃圾邮件的发送者来说，每一封邮件都要多花1分钟才能发送，这是完全不可以接受的。也就是说，<strong>这样的计算任务对正常用户来说成本是可控的，但对于试图大规模发送垃圾邮件的攻击者来说，计算成本会变得高不可攀。</strong></p>
<p>工作量证明机制的运行原理，就是通过不断的运算，寻找一个满足当前比特币系统难度目标要求的特定值——即区块哈希值需拥有特定数量的“前导零”。整个网络上最先成功找到该满足条件的哈希值的矿工节点，就赢得了生成该区块的权力，并会获得系统奖励的比特币和交易手续费。</p>
<p>这种经济激励驱动着越开越多的矿工节点持续投入算力参与竞争。并且随着比特币价值攀升，算力不断增长，网络会动态调整难度目标来维持平均约10分钟/块的区块生成速度。难度目标的不断提升意味着对矿工节点的计算能力要求越来越高，同时，当整个系统所拥有的算力越高时，任何恶意节点想要通过篡改历史交易来重组区块链所需的算力成本变得极其高昂，近乎成为不可能完成的任务，从而确保了区块链的安全性与不可篡改性。</p>
<h3 id="3比特币的最长链规则">3.比特币的“最长链”规则<a hidden class="anchor" aria-hidden="true" href="#3比特币的最长链规则">#</a></h3>
<p>由于节点间存在网络延迟等原因，矿工可能得到同一时间戳的区块，区块链可能出现临时的分叉，从而形成多条竞争链。那么接下来的区块生成竞争中，矿工节点在选择“前一区块哈希值”时将使用哪一个区块的哈希值？</p>
<p><img alt="图6 同时生成两个时间戳相同的区块示意图" loading="lazy" src="/media/bitcoin1/6.JPG">
图6 同时生成两个时间戳相同的区块示意图</p>
<p>比特币系统使用的是“<strong>最长链原则</strong>”。根据规则，负责打包交易数据、生产出区块的“矿工”节点始终选择<strong>累积工作量最多的区块链作为有效链</strong>。</p>
<p>因为有最大的工作量证明的算力投入到这条链上，<strong>“最长链”即代表了绝大多数参与节点的共识</strong>。在工作量证明（PoW）的机制下，如果比特币系统中大多数算力被诚实节点控制，那么诚实的链的计算工作量就会增长得最快并超过其他的竞争链。</p>
<p>攻击者若要修改过去的某区块中的交易数据，则必须重新计算这个区块以及其后的所有区块的工作量证明，还需要赶上并超过诚实节点的工作量证明。</p>
<p>并且，比特币系统的激励机制会鼓励矿工节点保持诚实——如果一个贪心的攻击者有能力聚集比其他所有诚实节点更多的算力，他将面临修改已有的交易记录还是生成新货币的抉择。在“最长链”原则、工作量证明等机制的作用下，相同算力时，生成新的区块比修改已有的交易收益更大，即<strong>遵守规则（生成新的区块）比破坏系统和他自己财产的有效性（修改已有的交易）更有利</strong>。</p>
<p>若如果两个节点同时像比特币网络中的其他节点广播了两个不同的区块，有些节点可能先收到其中一个而其他节点先收到另一个。在这种情况下，其他节点会基于他们收到的第一个区块工作，同时也会保存另一个区块以防止它变为更长的链。当下一个区块被找到后，这种僵局就会被打破，从而使得其中一个区块所代表的分支变得更长，根据“最长链”原则，在另一个分支上工作的节点将切换到更长的链上来。</p>
<p>“最长链”原则保证了比特币系统的<strong>一致性</strong>（所有的节点最终在同一个区块链版本上达成共识）、<strong>安全性</strong>，最重要的是<strong>使得系统解决了比特币区块链的暂时分叉问题</strong>。</p>
<p>新区块的广播并不一定能够达到网络上的所有节点。但区块广播是能够容忍消息丢失的，如果某个节点没有收到新产生的某个区块，它将在收到下一个区块的广播后发现它丢失了一个区块然后像其他节点请求这个区块。</p>
<h3 id="4比特币系统中的硬分叉与软分叉">4.比特币系统中的“硬分叉”与“软分叉”<a hidden class="anchor" aria-hidden="true" href="#4比特币系统中的硬分叉与软分叉">#</a></h3>
<p>在比特币系统中，<strong>所有节点遵循统一的交易数据格式、运行机制等等，从而形成并维护着整个系统的共识</strong>。<br>
因协议升级或规则变更，导致系统中出现了​​新的交易数据格式或运行机制​​，且该变化​​<strong>与原有共识规则不兼容​​</strong>，使得未升级的节点<strong>拒绝接受新规则产生的区块</strong>，称为​​**“硬分叉”​​**。此时，网络会分裂成两条独立的链。<br>
反之，若新规则​​与原有共识兼容​​，未升级节点仍<strong>能接受新规则产生的区块</strong>，则称为​​“软分叉​​”，在这种状况下，网络不会分裂，仍然保持一条链。</p>
<p>比特币现金
(BCH) 是硬分叉的典型，而隔离见证（SegWit）则属于软分叉的典型。</p>
<p>在比特币系统的原始协议中，为追求尽可能小的存储空间，每个​​区块大小被限制为1MB​​。这样的设定严重限制了比特币系统处理交易的速度，导致网络拥堵。面对这种问题，​​比特币核心开发团队​​主张通过“​​隔离见证（SegWit）​​”等方案（将原本为交易ID一部分的签名数据从交易输入中分离，放入一个独立的“见证”结构）进行优化，<strong>不直接扩大区块</strong>，进行软分叉​​升级。而扩容派​​则认为应直接将​​区块大小提升至8MB​​，​​进行硬分叉​​，以根本性解决扩容问题。</p>
<p>由于双方无法达成共识，扩容派中以Bitcoin ABC（Adjustable Blocksize
Cap）为首的开发团队，基于比特币原链的代码，开发了支持​​8MB区块​​且​​不包含隔离见证（SegWit）功能​​的新客户端软件，随后，支持扩容派的比特币“矿商”约定在比特币主链的​​区块高度478558​​之后执行硬分叉。即当比特币系统生成第478558个区块后，支持分叉的矿工将开始运行新客户端，按照新的规则验证和产生后续区块。最终，​​2017年8月1日​，比特币系统的区块链成功分裂为两条链，一条是沿用原有规则的​​比特币（BTC）链​​，另一条是遵循新规则的​​比特币现金（BCH）链​​。由于​​比特币现金（BCH）链​​分叉于比特币（BTC）链，因此比特币现金（BCH）在分叉点​​完全继承了BTC原链的交易历史​​，也就是说，在分叉时刻之前拥有BTC的用户，在BCH链上也会自动拥有​​等量的BCH，用户只要通过支持BCH的交易所或钱包来申领和操作这些新分叉出来的BCH资产。</p>
<p>​​隔离见证（SegWit）的“软分叉”升级方式，避免了区块链的永久分裂，未升级的旧节点​​仍然能够验证和接受​​新区块。</p>
<h2 id="三比特币的稀缺性">三、比特币的稀缺性<a hidden class="anchor" aria-hidden="true" href="#三比特币的稀缺性">#</a></h2>
<p>比特币系统的设计之初，设计者中本聪使用三种机制来确保比特币不会滥发。<br>
一是设定<strong>总供应量的限制</strong>，<br>
二是设定“<strong>减半</strong>”机制逐步减少新币的发行量，<br>
三是<strong>控制比特币发行的速度</strong>。</p>
<p><strong>比特币的总供应量是固定的，2100万枚。<strong>这一数量的设定写在比特币系统的源代码之中的，只有通过难以达成的全网共识修改协议，才能进行修改。截至笔者完成本文时，比特币系统已挖出的比特币数量​​约为</strong>1980万枚</strong>​​，占总供应量2100万枚的约94.3%，​​剩余可挖的比特币仅剩约120万枚​​，占比特币总量不到6%。并且，由于大部分的比特币在其价值较低的时期挖出的，据估计，约有<strong>300万至387万枚比特币</strong>可能因私钥丢失、硬盘损坏等原因永久丢失。</p>
<p>此外，中本聪还设定了“减半”时间逐步的减少比特币的发行速度。每210,000个区块（大约每四年），每一个区块中所包含的比特币奖励会减半。到目前为止，比特币已经经历了四次减半，分别在2012年11月28日从50BTC到25BTC、2016年7月9日从25BTC到12.5BTC、2020年5月11日从12.5BTC到6.25BTC、2024年4月19日从6.25BTC到3.125BTC</p>
<p><img alt="图7 比特币减半时间统计" loading="lazy" src="/media/bitcoin1/7.JPG">
图7 比特币减半时间统计</p>
<p>比特币的产生速度是固定的。上文提到，比特币系统通过设定难度目标、采用工作量证明机制将每一个区块的生成速度控制在10分钟左右。由于区块奖励是比特币的生成的唯一途径，因此，比特币的产生速度也在每10分钟左右。</p>
<p>实际上，比特币系统对于矿工节点的激励包括生成区块所创造的比特币和交易费两种形式。<br>
生成区块所创造的比特币指的就是源于生成区块的币基（coinbase）奖励，而交易费则源自——一笔未花费交易输出（UTXO）的输出值小于其输入值，两者的差价就作为交易费作为包含此交易的区块对于生成次区块的矿工节点的激励中。</p>
<p>当比特币的2100万枚在2140年被全部挖掘完毕后，比特币的总量将不再增加，生成区块所创造的比特币不在出现，区块链系统对于矿工节点的奖励来自于每一笔交易多出来的交易费。同时，矿工节点可以根据交易费的多少来决定打包交易的先后顺序。这样的机制确保比特币系统能够长期以去中心化的模式运行下去。</p>
<h2 id="四比特币的标准化可分割性与耐久性">四、比特币的标准化、可分割性与耐久性<a hidden class="anchor" aria-hidden="true" href="#四比特币的标准化可分割性与耐久性">#</a></h2>
<p>比特币系统采用的是分布式系统，比特币的交易记录遍布全球各个节点。由于全球各地各节点的一致的认可，比特币作为一种资产在全球范围内都具有<strong>一致的价值和特征</strong>。</p>
<p>作为由编程创造的数字货币，相较于在现实世界发行的法定货币或者其他实物货币，比特币具有天然的可分割特性。其最小的单位是聪”（Satoshi），与比特币的换算单位为：1
BTC = 1亿聪（1 Satoshi（聪） = 0.00000001
BTC）。当然，只要比特币系统能够经过社区达成修改协议硬性规定的共识，比特币还可以产生出更小的单位，<strong>理论上具有无限的分割性</strong>。</p>
<p>比特币存在于区块链上，是一种数字资产，不像实物货币（如纸币或金属币）会因物理磨损而失去价值。只要区块链网络运行，比特币就始终存在。同时，自2009年比特币网络启动以来，由于其去中心化的特性，比特币系统未曾因技术故障而停止运行，证明了其系统的鲁棒性和耐久性。</p>
<h2 id="五在比特币系统中的交易">五、在比特币系统中的交易<a hidden class="anchor" aria-hidden="true" href="#五在比特币系统中的交易">#</a></h2>
<h3 id="1基于交易的记账模型未花费的交易输出unspent-transaction-outputsutxo">1.基于交易的“记账”模型——未花费的交易输出(Unspent Transaction Outputs，UTXO)<a hidden class="anchor" aria-hidden="true" href="#1基于交易的记账模型未花费的交易输出unspent-transaction-outputsutxo">#</a></h3>
<p>每个人都早已习惯<strong>基于账户的记账方式</strong>。日常生活中每个人脑子中都存在一个余额系统，我们记住了我们的账户入账了多少，出账了多少，通过数学的运算，我们最后的记忆落在了账户中还剩下多少上。但与我们日常的直觉不同，比特币系统并未采用基于账户的记账模型，而是采用<strong>基于交易的模型</strong>，学名叫做“未花费交易输出”（Unspent
Transaction Output, UTXO）。</p>
<p>在基于交易的模型中，每个交易由交易输入和交易输出两个部分组成，<strong>交易输入</strong>和<strong>交易输出</strong>可以同时记录多条不同的交易，如下图：</p>
<p><img alt="图8 比特币交易的数据结构" loading="lazy" src="/media/bitcoin1/8.JPG">
图8 比特币交易的数据结构</p>
<p><strong>交易中的输入部分</strong>主要由上笔<strong>交易</strong>的哈希PrevTxHash、上笔交易的输出索引Index（输入部分所指向的之前交易的，也就是<strong>交易比特币的来源</strong>）和输入脚本ScriptSig（证明所交易的比特币使用权的​​凭证​​）组成。<br>
对于<strong>交易输出</strong>的结构，每个输出包括<strong>转账金额Value</strong>和<strong>包含接收者公钥哈希的脚本Script-PubKey</strong>。</p>
<p>在基于交易的模型中，每一笔交易都通过在输入部分写入上一笔交易的哈希值，构成以交易为节点的链式结构。这种设计使得<strong>任意一笔比特币交易都可以向前追溯至其源头</strong>——即币基（coinbase）交易（由挖矿生成的比特币），并<strong>向后追踪至尚未被花费的交易输出</strong>（UTXO）。如果一笔交易的输出没有任何另一笔交易的输入与之对应，则说明该输出中的比特币未被花费。</p>
<p>通过收集当前所有未花费的交易输出(Unspent Transaction
Outputs，UTXO)，<strong>可快速验证某交易中的比特币是否已花费</strong>。针对某一比特币地址，<strong>其所有未花费交易的比特币之和，就是该账户的比特币余额</strong>。</p>
<p>基于交易的模型可有效地防范伪造、双花等针对去中心化数字货币系统的攻击。更重要的是，相较于基于账户的传统交易计算方式，比特币系统采用的基于交易的模型有效的节约了计算、存储资源，推动了比特币系统的普及，如上文中所提到，从2009年的创世区块至今，比特币的全节点储存的数据大约为<strong>650GB</strong>，相比之下，由于轻节点不存储完整区块链，只需存储区块头和部分数据，总体的数据量大约在<strong>80-100MB左右</strong>，相比之下，大型银行的存储由于存储了账户余额、交易明细以及为支持这些业务产生的庞大日志、审计和合规数据，10年核心系统数据总量达到<strong>PB级别</strong>是非常正常的​​。</p>
<h3 id="2-比特币的交易过程">2. 比特币的交易过程<a hidden class="anchor" aria-hidden="true" href="#2-比特币的交易过程">#</a></h3>
<p><img alt="图9 比特币的交易过程" loading="lazy" src="/media/bitcoin1/9.JPG">
图9 比特币的交易过程</p>
<p>以上为比特币交易的过程。为了方便理解，本处使用（杨晓晨，2014）中的叙述来进行阐释：“交易单1中其实包含以下六种信息：<br>
一是交易单1的ID；<br>
二是资金的来源，即交易单0的ID；<br>
三是A对资金的签名，以证明是他把100BTC给B的；<br>
四是资金的去向，即C的账号（公钥）；<br>
五是资金的数额，即100 BTC；<br>
六是B的签名（即B用自己私钥进行的数字签名），以证明是他自己签发的交易。<br>
由于每笔交易单都记录了<strong>该笔资金的前一个拥有者、当前拥有者以及后一个拥有者，我们就可以依据交易单实现对资金的全程追溯</strong>。<br>
最后，当每一笔交易完成时，系统都会向全网进行广播，告诉所有用户这笔交易的实施。”</p>
<h3 id="3还没被打包进区块的交易在哪关于内存池mempool">3.还没被打包进区块的交易在哪？——关于内存池（Mempool）<a hidden class="anchor" aria-hidden="true" href="#3还没被打包进区块的交易在哪关于内存池mempool">#</a></h3>
<p>在比特币系统中，还没有被矿工节点选中被打包进区块中的交易都会被存放在内存池（Mempool）中。​​内存池（Mempool）是比特币系统的<strong>缓冲区</strong>和<strong>调度中心</strong>​​，系统中所有未被确认、未被打包进区块的交易都在内存池中暂存并进行排序。</p>
<p>内存池中的交易主要按手续费率（每字节聪数）来进行排序，矿工节点将会优先打包高费率交易。值得一提的是，比特币系统还曾采用优先级（优先级
= (SUM(输入金额 * 输入年龄)) /
交易大小（字节））作为辅助排序标准，来避免低手续费或零手续费交易长期未被确认的问题。</p>
<h2 id="六总结比特币系统运行的全过程">六、总结——比特币系统运行的全过程<a hidden class="anchor" aria-hidden="true" href="#六总结比特币系统运行的全过程">#</a></h2>
<p>作为一套尝试用数学信用对抗国家强权背书（国家信用）的金融系统，比特币系统通过融合使用密码学、分布式网络和经济学原理，成功构建了一个​​去中心化、安全且稀缺​​的数字货币系统。</p>
<p>根据文献及笔者已有认知，现对比特币系统基本架构作以下四个层面的概括：</p>
<p><strong>​​1.密码学基础层​​</strong>​​：<br>
通过​​非对称加密​​和​​哈希函数​​等密码学算法确保所有权验证和交易完整性。</p>
<p><strong>2.分布式网络层​​</strong>​​：<br>
通过运用遍布全球的分布式网络体系，使得系统​​中所有节点能够在没有中心服务器的状态下，平等参与系统的运行，达成统一共识。</p>
<p><strong>3.共识与安全层​​</strong>​​：<br>
<strong>​​工作量证明</strong>​​（PoW）：通过促使各矿工节点投入算力计算满足难度目标（“前导零”数量要求）的区块哈希值竞争记账权，消耗算力来抵御51%攻击。<br>
<strong>最长链原则</strong>​​：自动选择累积工作量最大的链为主链，解决临时分叉问题，从而确保全网最终一致性节点。<br>
<strong>未花费输出（UTXO）模型</strong>：采用与基于账户的记账方式不同的基于交易的记账方式，每笔交易的比特币都消耗先前未花费输出，并生成新输出，从而能够达到追溯至比特币来源、全网节点验证其唯一性的目的。</p>
<p><strong>4.经济与治理层​​</strong>​​：<br>
稀缺性机制：固定总量为2100万枚，通过每4年奖励减半来控制发行速率。2140年区块奖励归零后，矿工节点的激励则来源于交易的交易费。</p>
<p>比特币系统的本质是一套​​基于数学和共识的信任系统​​，其取代了传统金融的中心化权威。其架构为区块链技术提供了范式，推动了去中心化金融的创新与发展。在笔者看来，其设计巧妙之处在于：<br>
（1）<strong>多学科融合</strong>：比特币融合密码学与经济学等多学科内容，从解决实际问题的角度设置系统，打破传统的学术思维习惯。<br>
（2）<strong>激励相容​​</strong>：矿工在激励下投入算力维护网络安全，以获得区块奖励和交易费。整个过程中，其个人利益与系统健康运行的利益一致。即使面临破坏系统的策略，比特币系统通过激励机制的分配，能够确保诚实的挖矿节点因经济回报更高而占主导，进一步保证系统长期运行的可持续性。<br>
（3）<strong>鲁棒性​​</strong>：分布式存储和共识机制使比特币系统具有抗单点故障和攻击的能力，区块链数据储存于分布于全球的不同节点中，确保比特币系统能够持续运行并具备高度抗审查的特性。<br>
（4）<strong>可验证性</strong>：任何节点可验证比特币系统中交易和区块的合法性，达到增强系统的透明度和去信任化特性的目的。<br>
（5）<strong>去中心化治理</strong>：比特币系统通过社区共识实现协议升级，系统中不存在中央权威控制，全部通过社区共识对比特币系统进行治理。</p>
<p>截至本文完成时，比特币价格已经达到$112,000。<br>
笔者认为这足以证明比特币系统存在的价值。下一篇文章，笔者将对比特币系统的价值做出主观、粗略的判断。</p>
<p>参考文献</p>
<ol>
<li>
<p><a href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a></p>
</li>
<li>
<p><a href="https://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf">https://bitcoin.org/files/bitcoin-paper/bitcoin_zh_cn.pdf</a></p>
</li>
<li>
<p><a href="http://blockchain.mit.edu/how-blockchain-works/">http://blockchain.mit.edu/how-blockchain-works/</a></p>
</li>
<li>
<p><a href="https://liaoxuefeng.com/books/blockchain/bitcoin/p2p/public-key/index.html">https://liaoxuefeng.com/books/blockchain/bitcoin/p2p/public-key/index.html</a></p>
</li>
<li>
<p><a href="https://www.zhihu.com/column/p/28036845">https://www.zhihu.com/column/p/28036845</a></p>
</li>
<li>
<p><a href="https://www.bilibili.com/video/BV1WM411y7Vf?vd_source=d96e19e5f16193c9ab4bbdd870870971">https://www.bilibili.com/video/BV1WM411y7Vf?vd_source=d96e19e5f16193c9ab4bbdd870870971</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/128097006">https://zhuanlan.zhihu.com/p/128097006</a></p>
</li>
<li>
<p><a href="https://cloud.tencent.com/developer/article/1141901">https://cloud.tencent.com/developer/article/1141901</a></p>
</li>
<li>
<p>Lamport L, Shostak R, Pease M. The Byzantine generals
problem[M]//Concurrency: the works of leslie lamport. 2019:
203-226.</p>
</li>
<li>
<p>杨晓晨,张明.比特币:运行原理、典型特征与前景展望[J].金融评论,2014,6(01):38-53+124.</p>
</li>
<li>
<p>贾丽平.比特币的理论、实践与影响[J].国际金融研究,2013,(12):14-25.</p>
</li>
<li>
<p>邵奇峰,金澈清,张召,等.区块链技术:架构及进展[J].计算机学报,2018,41(05):969-988.</p>
</li>
<li>
<p>袁勇,王飞跃.区块链技术发展现状与展望[J].自动化学报,2016,42(04):481-494.DOI:10.16383/j.aas.2016.c160158.</p>
</li>
<li>
<p>沈鑫,裴庆祺,刘雪峰.区块链技术综述[J].网络与信息安全学报,2016,2(11):11-20.</p>
</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://yuhengliuleo.github.io/">Leo</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
